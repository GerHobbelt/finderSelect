!function(a){var b=a(document),c=a("body"),d=a.fn.finderSelect=function(b){var c=a(this),e={selectClass:"selected",unSelectClass:"un-selected",currentClass:"selected-current",lastClass:"selected-last",shiftClass:"selected-shift",ctrlClass:"selected-ctrl",triggerUpdate:"finderSelectUpdate",children:!1,event:"mousedown",cursor:"pointer",dragEvent:"mouseenter",enableClickDrag:!0,enableShiftClick:!0,enableCtrlClick:!0,enableSingleClick:!0,enableSelectAll:!0,enableDisableSelection:!0,enableTouchCtrlDefault:!0,totalSelector:!1,menuSelector:!1,menuXOffset:0,menuYOffset:0};a.extend(e,b),e.children||(e.children=d.detect.children(c)),d.h.off(d.get.siblings(c,e),e),e.cursor&&d.set.cursor(c,e),e.enableDisableSelection&&d.core.disableSelection(c,e),e.enableClickDrag&&d.core.clickDrag(c,e),e.enableSelectAll&&d.core.selectAll(c,e),(e.enableShiftClick||e.enableCtrlClick||e.enableSingleClick)&&d.core.click(c,e),e.totalSelector&&d.core.totalUpdate(c,e),e.menuSelector&&d.core.loadMenu(c,e)};d.core={clickDrag:function(b,e){return d.set.mouseDown(!1),c.mousedown(function(a){d.detect.leftMouse(a)&&d.set.mouseDown(!0)}),c.mouseup(function(a){d.detect.leftMouse(a)&&d.set.mouseDown(!1)}),b.on(e.dragEvent,e.children,function(c){var f=d.get.clicks(b,e,a(this));d.get.mouseDown()&&d.detect.ctrl(c)&&(d.t.deleteSelection(e),d.t.toggleDrag(b,f,e),d.set.clicks(f.hard.v,null,f.current.v,b,e))}),b},click:function(b,c){b.on(c.event,c.children,function(e){if(d.detect.leftMouse(e)){var f=d.get.clicks(b,c,a(this));d.detect.ctrl(e)&&c.enableCtrlClick||!d.detect.shift(e)||!c.enableShiftClick||(d.t.deleteSelection(c),d.t.shiftClick(b,f,c),d.set.clicks(f.hard.v,f.current.v,null,b,c)),!(d.detect.ctrl(e)&&c.enableCtrlClick||d.detect.touch()&&c.enableTouchCtrlDefault)||d.detect.shift(e)&&c.enableShiftClick||(d.t.toggleClick(b,f,c),d.set.clicks(f.current.v,null,null,b,c)),d.detect.ctrl(e)&&c.enableCtrlClick||d.detect.shift(e)&&c.enableShiftClick||!c.enableSingleClick||(d.t.singleClick(b,f,c),d.set.clicks(f.current.v,null,null,b,c))}})},selectAll:function(a,c){function e(b){d.detect.ctrl(b)&&65==b.keyCode&&(b.preventDefault(),d.detect.alt(b)?d.t.unHAll(a,c):d.t.hAll(a,c))}a.on("mouseenter",function(){b.on("keydown",e)}),a.on("mouseleave",function(){b.off("keydown",e)})},totalUpdate:function(b,c){b.on(c.triggerUpdate,function(){a(c.totalSelector).html(a(this).find(c.children).filter("."+c.selectClass).length)})},loadMenu:function(b,c){b.bind("contextmenu",function(b){return a(c.menuSelector).css({left:b.pageX+c.menuXOffset,top:b.pageY+c.menuYOffset}).show(),!1}).bind("mousedown",function(){a(c.menuSelector).hide()}),a(c.menuSelector).bind("click",function(){a(this).hide()})},disableSelection:function(a,b){function d(){return!1}c.on("keydown",function(){a.on("selectstart",b.children,d)}).on("keyup",function(){a.off("selectstart",b.children,d)})}},d.h={on:function(a,b){a.removeClass(b.unSelectClass),a.addClass(b.selectClass)},off:function(a,b){a.removeClass(b.selectClass),a.addClass(b.unSelectClass)},tog:function(a,b){d.detect.h(a,b)?d.h.off(a,b):d.h.on(a,b)}},d.detect={leftMouse:function(a){return 1==a.which},shift:function(a){return a.shiftKey},alt:function(a){return a.altKey},ctrl:function(a){return a.ctrlKey||a.metaKey},h:function(a,b){return a.hasClass(b.selectClass)},touch:function(){return!!("ontouchstart"in window)||!!("onmsgesturechange"in window)},children:function(a){return a.children().get(0).tagName}},d.set={clicks:function(a,b,c,e,f){d.set.click(e,!1,f.currentClass),d.set.click(e,a,f.lastClass),d.set.click(e,b,f.shiftClass),d.set.click(e,c,f.ctrlClass),d.t.update(e,f)},click:function(a,b,c){d.get.click(a,c).removeClass(c),b&&b.addClass(c)},mouseDown:function(a){return c.data("down",a)},cursor:function(a,b){var c=d.get.siblings(a,b);return c.css("cursor",b.cursor)}},d.get={clicks:function(a,b,c){var e={};return d.set.click(a,c,b.currentClass),e.current={v:c,c:b.currentClass},e.hard={v:d.get.click(a,b.lastClass),c:b.lastClass},e.shift={v:d.get.click(a,b.shiftClass),c:b.shiftClass},e.ctrl={v:d.get.click(a,b.ctrlClass),c:b.ctrlClass},e},click:function(a,b){return a.find("."+b)},mouseDown:function(){return c.data("down")},siblings:function(a,b){return a.find(b.children)},between:function(a,b,c){return a.index(b.v)<a.index(c.v)?d.get.elem(!0,b.v,!1,c.c):d.get.elem(!1,b.v,!1,c.c)},elem:function(b,c,d,e){for(var f=[],g=b?c.next():c.prev();g.length;)"undefined"!=typeof e&&e&&g.hasClass(e)?g={}:(("undefined"==typeof d||!d||g.hasClass(d))&&f.push(g[0]),g=b?g.next():g.prev());return a(f)}},d.t={update:function(a,b){return a.trigger(b.triggerUpdate)},deleteSelection:function(a){if(a.enableDisableSelection&&document.getSelection){var b=document.getSelection();b.removeAllRanges&&b.removeAllRanges()}},singleClick:function(a,b,c){var e=d.get.siblings(a,c);d.h.off(e,c),d.h.on(b.current.v,c)},toggleClick:function(a,b,c){d.h.tog(b.current.v,c)},toggleDrag:function(a,b,c){var e=d.get.siblings(a,c),f=e.index(b.hard.v),g=e.index(b.ctrl.v),h=e.index(b.current.v);0!=b.ctrl.v.length?(h>=f&&g>h||f>=h&&h>g?d.h.tog(b.ctrl.v,c):d.h.tog(b.current.v,c),d.h.tog(d.get.between(e,b.current,b.ctrl),c)):(b.current.v!=b.hard.v&&d.h.tog(d.get.between(e,b.current,b.hard),c),d.h.tog(b.current.v,c))},shiftClick:function(b,c,e){var f=d.get.siblings(b,e),g=f.index(c.current.v),h=f.index(c.hard.v);if(0!=c.hard.v.length&&!d.detect.h(c.hard.v,e)){var i=d.get.elem(!0,c.hard.v,e.selectClass);if(i.length>0)c.hard.v=a(i[0]),d.set.click(b,c.hard.v,e.lastClass);else{var i=d.get.elem(h>g,c.hard.v,e.selectClass);i.length>0?(i=g>h?a(i[0]):a(i[i.length-1]),c.hard.v=i,d.set.click(b,c.hard.v,e.lastClass)):(c.hard.v=f.first(),d.set.click(b,c.hard.v,e.lastClass),d.t.singleClick(f,{current:{v:f.first()}},e))}}var h=f.index(c.hard.v),j=f.index(c.shift.v),g=f.index(c.current.v);0==c.hard.v.length&&d.t.singleClick(f,{current:{v:f.first()}},e),0!=c.shift.v.length?((j>h&&g>h&&j>g||h>j&&h>g&&g>j)&&d.h.off(d.get.between(f,c.shift,c.current),e),(j>h&&h>g&&j>g||h>j&&g>h&&g>j)&&(d.h.off(d.get.between(f,c.shift,c.hard),e),d.h.on(d.get.between(f,c.current,c.hard),e)),h>j&&h>g&&j>g||j>h&&g>h&&g>j||h==j?d.h.on(d.get.between(f,c.shift,c.current),e):(d.h.off(c.shift.v,e),d.t.unHExist(g>j,c.shift.v,e))):(d.t.unHExist(g>h,c.hard.v,e),d.h.on(d.get.between(f,c.current,c.hard),e)),d.h.on(c.current.v,e)},unHAll:function(a,b){d.h.off(a.find(b.children),b)},hAll:function(a,b){d.h.on(a.find(b.children),b)},unHExist:function(a,b,c){a?d.h.off(d.get.elem(!1,b,!1,c.unSelectClass),c):d.h.off(d.get.elem(!0,b,!1,c.unSelectClass),c)}}}(window.jQuery||window.Zepto);