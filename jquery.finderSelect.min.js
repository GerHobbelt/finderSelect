(function(e){e.fn.finderSelect=function(t){var n={selectClass:"selected",children:false,event:"mousedown",cursor:"pointer",dragEvent:"mouseenter",enableClickDrag:true,enableShiftClick:true,enableCtrlClick:true,enableSingleClick:true,enableDisableSelection:true,enableTouchCtrlDefault:true,totalSelector:false,menuSelector:false,menuXOffset:0,menuYOffset:0};var r=e(this);e.extend(n,t);if(n.children===false){n.children=e.fn.finderSelect.detectChildType(r)}var i=r.find(n.children);if(n.cursor!==false){e.fn.finderSelect.applyCursor(i,n.cursor)}if(n.enableDisableSelection){e.fn.finderSelect.disableSelection(r,n)}if(n.enableClickDrag){e.fn.finderSelect.enableClickDrag(r,n)}if(n.enableShiftClick||n.enableCtrlClick||n.enableSingleClick){e.fn.finderSelect.enableClick(r,n)}if(n.totalSelector){e.fn.finderSelect.totalUpdate(r,n)}if(n.menuSelector){e.fn.finderSelect.loadMenu(r,n)}};e.fn.finderSelect.highlight=function(e,t){if(t===undefined){t="selected"}return e.addClass(t)};e.fn.finderSelect.isTouchDevice=function(){return!!("ontouchstart"in window)||!!("onmsgesturechange"in window)};e.fn.finderSelect.unHighlight=function(e,t){if(t===undefined){t="selected"}return e.removeClass(t)};e.fn.finderSelect.isHighlighted=function(e,t){if(t===undefined){t="selected"}return e.hasClass(t)};e.fn.finderSelect.toggleHighlight=function(t,n){if(n===undefined){n="selected"}if(e.fn.finderSelect.isHighlighted(t,n)){e.fn.finderSelect.unHighlight(t,n)}else{e.fn.finderSelect.highlight(t,n)}return t};e.fn.finderSelect.between=function(e,t,n){if(t>n){return e.filter(":lt("+t+")").filter(":gt("+n+")")}else{return e.filter(":lt("+n+")").filter(":gt("+t+")")}};e.fn.finderSelect.disableSelection=function(t,n){function i(){return false}var r=e("body");r.on("keydown",function(){t.on("selectstart",n.children,i)});r.on("keyup",function(){t.off("selectstart",n.children,i)})};e.fn.finderSelect.detectChildType=function(e){return e.children().get(0).tagName};e.fn.finderSelect.applyCursor=function(e,t){return e.css("cursor",t)};e.fn.finderSelect.enableClickDrag=function(t,n){e.fn.finderSelect.setMouseDown(false);e("body").mousedown(function(t){if(e.fn.finderSelect.detectLeftMouse(t)){e.fn.finderSelect.setMouseDown(true)}}).mouseup(function(t){if(e.fn.finderSelect.detectLeftMouse(t)){e.fn.finderSelect.setMouseDown(false)}});t.on(n.dragEvent,n.children,function(r){var i=t.find(n.children);var s=e.fn.finderSelect.getPrimary(t);var o=e.fn.finderSelect.getTertiary(t);var u=i.index(this);var a=e(this);if(e.fn.finderSelect.getMouseDown()&&e.fn.finderSelect.detectCtrl(r)){e.fn.finderSelect.ctrlSelection(i,a,s,o,u,n);e.fn.finderSelect.setPrimary(t,s);e.fn.finderSelect.setSecondary(t,null);e.fn.finderSelect.setTertiary(t,u);e.fn.finderSelect.triggerUpdate(t)}});return t};e.fn.finderSelect.enableClick=function(t,n){t.on(n.event,n.children,function(r){if(e.fn.finderSelect.detectLeftMouse(r)){var i=e(this);var s=e.fn.finderSelect.getPrimary(t);var o=e.fn.finderSelect.getSecondary(t);var u=t.find(n.children);var a=u.index(this);var f=u.index(u.eq(s).nextAll("."+n.selectClass).first());if(!e.fn.finderSelect.isHighlighted(u.eq(s),n.selectClass)){s=f}if(e.fn.finderSelect.detectShift(r)&&n.enableShiftClick){if(n.enableDisableSelection){e.fn.finderSelect.deleteSelection()}if(s==null){s=0}e.fn.finderSelect.shiftSelection(u,i,s,o,a,n);e.fn.finderSelect.highlight(i,n.selectClass);e.fn.finderSelect.setPrimary(t,s);e.fn.finderSelect.setSecondary(t,a)}else{if(e.fn.finderSelect.detectCtrl(r)&&n.enableCtrlClick||e.fn.finderSelect.isTouchDevice()&&n.enableTouchCtrlDefault){if(e.fn.finderSelect.isHighlighted(i,n.selectClass)){e.fn.finderSelect.unHighlight(i,n.selectClass)}else{e.fn.finderSelect.highlight(i,n.selectClass)}}else{if(n.enableSingleClick){e.fn.finderSelect.unHighlight(u,n.selectClass);e.fn.finderSelect.highlight(i,n.selectClass)}}e.fn.finderSelect.setPrimary(t,a);e.fn.finderSelect.setSecondary(t,null)}e.fn.finderSelect.triggerUpdate(t);e.fn.finderSelect.setTertiary(t,null)}});return t};e.fn.finderSelect.deleteSelection=function(){if(document.getSelection){var e=document.getSelection();if(e.removeAllRanges){e.removeAllRanges()}}};e.fn.finderSelect.ctrlSelection=function(t,n,r,i,s,o){if(i!=null){if(s>=r&&s<i||s<=r&&s>i){e.fn.finderSelect.toggleHighlight(t.eq(i),o.selectClass)}else{e.fn.finderSelect.toggleHighlight(n,o.selectClass)}e.fn.finderSelect.toggleHighlight(e.fn.finderSelect.between(t,s,i),o.selectClass)}else{e.fn.finderSelect.toggleHighlight(e.fn.finderSelect.between(t,s,r),o.selectClass);e.fn.finderSelect.toggleHighlight(n,o.selectClass)}};e.fn.finderSelect.shiftSelection=function(t,n,r,i,s,o){if(i!=null){if(r<i&&r<s&&s<i||r>i&&r>s&&s>i){e.fn.finderSelect.unHighlight(e.fn.finderSelect.between(t,i,s),o.selectClass)}if(r<i&&r>s&&s<i||r>i&&r<s&&s>i){e.fn.finderSelect.unHighlight(e.fn.finderSelect.between(t,i,r),o.selectClass);e.fn.finderSelect.highlight(e.fn.finderSelect.between(t,s,r),o.selectClass)}if(r>i&&r>s&&s<i||r<i&&r<s&&s>i||r==i){e.fn.finderSelect.highlight(e.fn.finderSelect.between(t,i,s),o.selectClass)}else{e.fn.finderSelect.unHighlight(t.eq(i),o.selectClass);if(s>i){e.fn.finderSelect.unHighlight(t.eq(i).prevUntil(o.children+":not(."+o.selectClass+")"),o.selectClass)}else{e.fn.finderSelect.unHighlight(t.eq(i).nextUntil(o.children+":not(."+o.selectClass+")"),o.selectClass)}}}else{if(r<s){e.fn.finderSelect.unHighlight(t.eq(r).prevUntil(o.children+":not(."+o.selectClass+")"),o.selectClass)}else{e.fn.finderSelect.unHighlight(t.eq(r).nextUntil(o.children+":not(."+o.selectClass+")"),o.selectClass)}e.fn.finderSelect.highlight(e.fn.finderSelect.between(t,s,r),o.selectClass)}e.fn.finderSelect.highlight(n,o.selectClass)};e.fn.finderSelect.getMouseDown=function(){return e("body").data("down")};e.fn.finderSelect.setMouseDown=function(t){return e("body").data("down",t)};e.fn.finderSelect.detectLeftMouse=function(e){return e.which==1};e.fn.finderSelect.detectShift=function(e){return e.shiftKey};e.fn.finderSelect.detectCtrl=function(e){return e.ctrlKey||e.metaKey};e.fn.finderSelect.setPrimary=function(e,t){return e.data("finderSelectPrimary",t)};e.fn.finderSelect.getPrimary=function(e){return e.data("finderSelectPrimary")};e.fn.finderSelect.setTertiary=function(e,t){return e.data("finderSelectTertiary",t)};e.fn.finderSelect.getTertiary=function(e){return e.data("finderSelectTertiary")};e.fn.finderSelect.triggerUpdate=function(e){return e.trigger("finderSelectUpdate")};e.fn.finderSelect.setSecondary=function(e,t){return e.data("finderSelectSecondary",t)};e.fn.finderSelect.getSecondary=function(e){return e.data("finderSelectSecondary")};e.fn.finderSelect.totalUpdate=function(t,n){t.on("finderSelectUpdate",function(){e(n.totalSelector).html(e(this).find(n.children).filter("."+n.selectClass).length)});return t};e.fn.finderSelect.loadMenu=function(t,n){t.bind("contextmenu",function(t){e(n.menuSelector).css({left:t.pageX+n.menuXOffset,top:t.pageY+n.menuYOffset}).show();return false});t.bind("mousedown",function(t){e(n.menuSelector).hide()});e(n.menuSelector).bind("click",function(t){e(this).hide()});return t}})(jQuery)